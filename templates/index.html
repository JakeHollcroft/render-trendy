<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trendii - Trending Across the Web</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
#source-filters label {
      display: flex;
      align-items: center;
      background-color: #e0f2f1;
      border-radius: 20px;
      padding: 0.3rem 0.7rem;
      font-size: 0.9rem;
      color: #004d40;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    #source-filters label:hover {
      background-color: #b2dfdb;
    }
    #source-filters input[type="checkbox"] {
      margin-right: 6px;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      margin: 0; padding: 0;
      color: var(--text-color);
    }
    header {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 1rem;
      font-size: 2rem;
      text-align: center;
      font-weight: 700;
      user-select: none;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      padding: 1rem;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card h2 {
      font-size: 1.2rem;
      margin: 0 0 0.5rem 0;
      flex-grow: 0;
    }
    .card h2 a {
      color: #00796b;
      text-decoration: none;
    }
    .card h2 a:hover {
      text-decoration: underline;
    }
    .description {
      font-size: 0.95rem;
      margin-bottom: 0.7rem;
      flex-grow: 1;
      white-space: pre-wrap;
      max-height: 15em;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .source {
      font-size: 0.8rem;
      font-weight: 700;
      margin-top: auto;
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      display: inline-block;
      color: white;
    }
    .source.ReutersTrending { background-color: #2f3e46; }
    .source.CNNTrending { background-color: #CC0000; }
    .source.IMDbTrending { background-color: #F5DE50; }
    .source.BillboardTrending { background-color: #f76060; }
    .source.SpotifyTrending { background-color: #1DB954; }
    .source.SteamChartsTrending { background-color: #171A21; }
    .source.GoodreadsTrending { background-color: #372213; }
    .source.WiredTrending { background-color: #FF0000; }
    .source.ArsTechnicaTrending { background-color: #FF4E00; }
    .source.LobstersTrending { background-color: #a52a2a; }
    .source.MediumtechTrending { background-color: #00ab6c; }
    .source.DevtoTrending { background-color: #0a0a0a; }
    .source.StackoverflowTrending { background-color: #f48024; }
    .source.TechcrunchTrending { background-color: #0f9d58; }
    .source.HackerTrending { background-color: #ff6600; }
    .source.GithubTrending { background-color: #24292e; }
    .source.SlashdotTrending { background-color: #026664; }
    .source.RedditTrending { background-color: #ff4500; }
    .source.DiggTrending { background-color: #000000; }
    .source.BBCTrending { background-color: #bb1919; }
    .source.XTrending { background-color: #1da1f2; }
    .source.YouTubeTrending { background-color: #cc0000; }
    img, video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 0.8rem;
      max-height: 200px;
      object-fit: cover;
    }
    video { outline: none; }
    /* Trend of the Day Styling */
    .trend-of-the-day {
      background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
      border: 2px solid #ffd700;
      border-radius: 10px;
      padding: 1rem;
      margin: 1rem auto;
      max-width: 600px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .trend-of-the-day h2 {
      font-size: 1.5rem;
      color: white;
    }
    .trend-of-the-day .source {
      background-color: rgba(0, 0, 0, 0.7);
    }
    /* Mood Tags Styling */
    .mood-tags {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .mood-tags .badge {
      font-size: 0.8rem;
    }
    @media (max-width: 768px) {
      header {
        font-size: 1.5rem;
        padding: 0.7rem;
      }
      #filter-bar {
        padding: 1rem 0.5rem;
      }
      #source-filters {
        flex-direction: column;
        align-items: stretch;
      }
      #source-filters label {
        width: 100%;
        justify-content: flex-start;
      }
      .card {
        padding: 0.8rem;
      }
      .card h2 {
        font-size: 1rem;
      }
      .description {
        font-size: 0.9rem;
      }
      .source {
        font-size: 0.75rem;
      }
      .votes button {
        font-size: 0.85rem;
        padding: 0.25rem 0.5rem;
      }
      .trend-of-the-day h2 {
        font-size: 1.2rem;
      }
    }
    @media (max-width: 480px) {
      .card h2 {
        font-size: 0.95rem;
      }
      .description {
        font-size: 0.85rem;
      }
      header {
        font-size: 1.3rem;
      }
      .btn {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }
    }
    /* Existing source-specific card styles */
    .card.HackerTrending { border-left: 4px solid #ff6600; background: #fff6f0; }
    .card.GithubTrending { border-left: 4px solid #24292e; background: #f8f9fa; }
    .card.RedditTrending { border-left: 4px solid #ff4500; background: #fff0f0; }
    .card.YouTubeTrending { border-left: 4px solid #cc0000; background: #ffe6e6; }
    .card.XTrending { border-left: 4px solid #1da1f2; background: #e6f3ff; }
    .card.BBCTrending { border-left: 4px solid #bb1919; background: #ffe6e6; }
    .card.DiggTrending { border-left: 4px solid #000000; background: #f8f9fa; }
    .card.SlashdotTrending { border-left: 4px solid #026664; background: #e6fafa; }
    .card.TechcrunchTrending { border-left: 4px solid #0f9d58; background: #e6f7ec; }
    .card.StackoverflowTrending { border-left: 4px solid #f48024; background: #fff5e6; }
    .card.DevtoTrending { border-left: 4px solid #0a0a0a; background: #f8f9fa; }
    .card.MediumtechTrending { border-left: 4px solid #00ab6c; background: #e6f7ec; }
    .card.LobstersTrending { border-left: 4px solid #a52a2a; background: #ffe6e6; }
    .card.WiredTrending { border-left: 4px solid #ff0000; background: #ffe6e6; }
    .card.ArsTechnicaTrending { border-left: 4px solid #ff4e00; background: #fff5e6; }
    .card.GoodreadsTrending { border-left: 4px solid #372213; background: #f8f9fa; }
    .card.SteamChartsTrending { border-left: 4px solid #171a21; background: #e6e9f0; }
    .card.SpotifyTrending { border-left: 4px solid #1db954; background: #e6f7ec; }
    .card.BillboardTrending { border-left: 4px solid #f76060; background: #fff0f0; }
    .card.IMDbTrending { border-left: 4px solid #f5de50; background: #fffbe6; }
    .card.CNNTrending { border-left: 4px solid #cc0000; background: #ffe6e6; }
    .card.ReutersTrending { border-left: 4px solid #2f3e46; background: #e6e9f0; }
    /* Theme variables */
    :root {
      --bg-color: linear-gradient(to bottom, #e0f7fa, #ffffff);
      --card-bg: #ffffff;
      --text-color: #333;
      --header-bg: #00796b;
      --header-text: #ffffff;
      --filter-bg: #00796b;
      --filter-text: #ffffff;
      --filter-label-bg: #e0f2f1;
      --filter-label-text: #004d40;
    }
    [data-theme="dark"] {
      --bg-color: linear-gradient(to bottom, #1a1a1a, #2c2c2c);
      --card-bg: #2c2c2c;
      --text-color: #e0e0e0;
      --header-bg: #004d40;
      --header-text: #e0e0e0;
      --filter-bg: #004d40;
      --filter-text: #e0e0e0;
      --filter-label-bg: #455a64;
      --filter-label-text: #e0e0e0;
    }
    [data-theme="fun"] {
      --bg-color: linear-gradient(to bottom, #ffeb3b, #ffca28);
      --card-bg: #fff9c4;
      --text-color: #d81b60;
      --header-bg: #f06292;
      --header-text: #ffffff;
      --filter-bg: #f06292;
      --filter-text: #ffffff;
      --filter-label-bg: #fce4ec;
      --filter-label-text: #d81b60;
    }
    #mobile-filter-toggle {
      display: none;
      background-color: var(--filter-bg);
      color: var(--filter-text);
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      width: 100%;
      text-align: left;
    }
    #filter-collapse {
      background: var(--filter-bg);
    }
    .collapse .filter-section {
      padding: 1rem;
    }

    /* Collapsible filters for desktop */
    #desktop-filters.collapsed .filter-section {
      display: none;
    }
    #desktop-filters-toggle {
      margin-bottom: 0.5rem;
    }

    /* Trend of the Day as a compact banner */
    .trend-of-the-day {
      background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
      border: 2px solid #ffd700;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      margin: 1rem auto;
      max-width: 95%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .trend-of-the-day h2 {
      font-size: 1.2rem;
      margin-bottom: 0.3rem;
      color: white;
    }
    .trend-of-the-day .card {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem;
      background: transparent;
      box-shadow: none;
    }
    .trend-of-the-day .card img {
      max-width: 80px;
      height: auto;
      border-radius: 8px;
    }
    .trend-of-the-day .card .description {
      display: none;
    }

    @media (max-width: 768px) {
      #mobile-filter-toggle {
        display: block;
      }
      #desktop-filters {
        display: none;
      }
    }
    @media (min-width: 769px) {
      #filter-collapse {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <header>
    üî• Trendii Now - Trending Across the Web
    <button id="theme-toggle" class="btn btn-sm btn-outline-light ms-3">Toggle Theme</button>
  </header>

  <!-- Trend of the Day -->
  {% if trend_of_the_day %}
  <section class="trend-of-the-day">
    <h2>üåü Trend of the Day</h2>
    <article class="card {{ trend_of_the_day.source_class }}" data-id="{{ trend_of_the_day.id }}">
      {% if trend_of_the_day.image %}
        <img src="{{ trend_of_the_day.image }}" alt="Image for {{ trend_of_the_day.title }}" />
      {% endif %}
      <div>
        <h2><a href="/trend/{{ trend_of_the_day.id }}">{{ trend_of_the_day.title }}</a></h2>
        <span class="source {{ trend_of_the_day.source_class }}">{{ trend_of_the_day.source }}</span>
      </div>
    </article>
  </section>
  {% endif %}

  <!-- Mobile Filter Toggle -->
  <button class="btn btn-secondary" id="mobile-filter-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#filter-collapse" aria-expanded="false" aria-controls="filter-collapse">
    Filter Sources
  </button>

  <div class="collapse" id="filter-collapse">
    <div class="filter-section">
      <strong style="color: var(--filter-text);">Filter by Source:</strong>
      <div id="source-filters" class="d-flex flex-wrap gap-2 mt-2">
        <label><input type="checkbox" id="all-sources" checked> All Sources</label>
        {% for source in unique_sources %}
          <label><input type="checkbox" value="{{ source }}" class="source-checkbox" checked> {{ source }}</label>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Desktop Collapsible Filters -->
  <div id="desktop-filters" class="text-center mt-2">
    <button class="btn btn-sm btn-outline-primary" id="desktop-filters-toggle">Toggle Filters</button>
    <div class="filter-section mt-2">
      <strong style="color: var(--filter-text);">Filter by Source:</strong>
      <div id="source-filters-desktop" class="d-flex flex-wrap gap-2 mt-2 justify-content-center">
        <label><input type="checkbox" id="all-sources-desktop" checked> All Sources</label>
        {% for source in unique_sources %}
          <label><input type="checkbox" value="{{ source }}" class="source-checkbox" checked> {{ source }}</label>
        {% endfor %}
      </div>
    </div>
  </div>

  <main class="container">
    {% for trend in trends %}
    <article class="card {{ trend.source_class }}" data-id="{{ trend.id }}">
      <h2><a href="/trend/{{ trend.id }}">{{ trend.title }}</a></h2>
      {% if trend.image %}
        <img src="{{ trend.image }}" alt="Image for {{ trend.title }}" />
      {% endif %}
      {% if trend.description %}
        <p class="description">{{ trend.description }}</p>
      {% endif %}
      {% if trend.mood_tags %}
        <div class="mood-tags">
          {% for tag in trend.mood_tags %}
            <span class="badge bg-primary">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}
      <span class="source {{ trend.source_class }}">{{ trend.source }}</span>
      <p>Trending: {{ time_ago(trend.timestamp) }}</p>
      <div class="votes d-flex gap-2">
        <button class="vote-btn btn btn-outline-primary btn-sm" data-type="thumbs_up">üëç <span class="vote-count" data-type="thumbs_up">{{ vote_counts.get(trend.id, {}).get('thumbs_up', 0) }}</span></button>
        <button class="vote-btn btn btn-outline-danger btn-sm" data-type="fire">üî• <span class="vote-count" data-type="fire">{{ vote_counts.get(trend.id, {}).get('fire', 0) }}</span></button>
        <button class="vote-btn btn btn-outline-info btn-sm" data-type="mind_blown">üò≤ <span class="vote-count" data-type="mind_blown">{{ vote_counts.get(trend.id, {}).get('mind_blown', 0) }}</span></button>
      </div>
      <a href="{{ trend.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary mt-3 align-self-start">See More</a>
    </article>
    {% endfor %}
  </main>

  <script>
    document.getElementById('desktop-filters-toggle')?.addEventListener('click', () => {
      document.getElementById('desktop-filters')?.classList.toggle('collapsed');
    });

    const allSourcesCheckbox = document.getElementById('all-sources');
    const allSourcesCheckboxDesktop = document.getElementById('all-sources-desktop');
    const checkboxes = document.querySelectorAll('.source-checkbox');
    const articles = document.querySelectorAll('.card');

    function filterArticles() {
      const activeSources = Array.from(checkboxes).filter(c => c.checked).map(c => c.value);
      articles.forEach(card => {
        const sourceClass = card.className.split(" ").find(cls => cls.endsWith("Trending"));
        if (!sourceClass || activeSources.includes(sourceClass.replace('Trending', ''))) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
    }

    checkboxes.forEach(cb => cb.addEventListener('change', filterArticles));
    [allSourcesCheckbox, allSourcesCheckboxDesktop].forEach(mainCb => {
      mainCb?.addEventListener('change', () => {
        checkboxes.forEach(cb => cb.checked = mainCb.checked);
        filterArticles();
      });
    });
  </script>
</body>
</html>
