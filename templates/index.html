<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trendii - Trending Across the Web</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-color);
      margin: 0; padding: 0;
      color: var(--text-color);
    }
    header {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 0.5rem 1rem;
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      user-select: none;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      padding: 1rem;
      max-width: 1200px;
      margin: auto;
    }
    .card {
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: scale(1.03);
    }
    .card h2 {
      font-size: 1.2rem;
      margin: 0 0 0.5rem 0;
      flex-grow: 0;
    }
    .card h2 a {
      color: #00796b;
      text-decoration: none;
    }
    .card h2 a:hover {
      text-decoration: underline;
    }
    .description {
      font-size: 0.95rem;
      margin-bottom: 0.7rem;
      flex-grow: 1;
      white-space: pre-wrap;
      max-height: 15em;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .source {
      font-size: 0.8rem;
      font-weight: 700;
      margin-top: auto;
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      display: inline-block;
      color: white;
    }
    .source.ReutersTrending { background-color: #2f3e46; }
    .source.CNNTrending { background-color: #CC0000; }
    .source.IMDbTrending { background-color: #F5DE50; }
    .source.BillboardTrending { background-color: #f76060; }
    .source.SpotifyTrending { background-color: #1DB954; }
    .source.SteamChartsTrending { background-color: #171A21; }
    .source.GoodreadsTrending { background-color: #372213; }
    .source.WiredTrending { background-color: #FF0000; }
    .source.ArsTechnicaTrending { background-color: #FF4E00; }
    .source.LobstersTrending { background-color: #a52a2a; }
    .source.MediumtechTrending { background-color: #00ab6c; }
    .source.DevtoTrending { background-color: #0a0a0a; }
    .source.StackoverflowTrending { background-color: #f48024; }
    .source.TechcrunchTrending { background-color: #0f9d58; }
    .source.HackerTrending { background-color: #ff6600; }
    .source.GithubTrending { background-color: #24292e; }
    .source.SlashdotTrending { background-color: #026664; }
    .source.RedditTrending { background-color: #ff4500; }
    .source.DiggTrending { background-color: #000000; }
    .source.BBCTrending { background-color: #bb1919; }
    .source.XTrending { background-color: #1da1f2; }
    .source.YouTubeTrending { background-color: #cc0000; }
    img, video {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 0.8rem;
      max-height: 200px;
      object-fit: cover;
    }
    video { outline: none; }
    /* Trend of the Day Styling */
    .trend-of-the-day {
      background: linear-gradient(90deg, #ff8a80, #4fc3f7);
      border: 1px solid #ffd700;
      border-radius: 8px;
      padding: 0.5rem;
      margin: 1rem auto;
      max-width: 600px;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .trend-of-the-day img {
      width: 80px;
      height: 80px;
      max-height: none;
      border-radius: 6px;
    }
    .trend-of-the-day h2 {
      font-size: 1rem;
      color: white;
      margin: 0;
      flex-grow: 1;
    }
    .trend-of-the-day .source {
      background-color: rgba(0, 0, 0, 0.7);
      font-size: 0.7rem;
    }
    .trend-of-the-day .mood-tags {
      margin: 0;
    }
    .trend-of-the-day .mood-tags .badge {
      font-size: 0.7rem;
    }
    /* Mood Tags Styling */
    .mood-tags {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .mood-tags .badge {
      font-size: 0.8rem;
    }
    /* Filter Styling */
    .filter-container {
      padding: 1rem;
      max-width: 1200px;
      margin: 1rem auto;
      background: var(--filter-bg);
      border-radius: 10px;
    }
    .filter-container .accordion-button {
      background: var(--filter-label-bg);
      color: var(--filter-label-text);
      font-weight: 500;
      transition: background-color 0.2s ease;
    }
    .filter-container .accordion-button:hover {
      background: #b2dfdb;
    }
    .filter-container .accordion-body {
      background: var(--card-bg);
      padding: 0.5rem;
    }
    .filter-container .form-check-label {
      cursor: pointer;
      padding: 0.3rem 0.5rem;
      border-radius: 5px;
      transition: background-color 0.2s ease;
    }
    .filter-container .form-check-label:hover {
      background: #e0f2f1;
    }
    /* Offcanvas Styling */
    .offcanvas {
      background: var(--card-bg);
      color: var(--text-color);
    }
    .offcanvas-header {
      background: var(--header-bg);
      color: var(--header-text);
    }
    /* Mobile Adjustments */
    @media (max-width: 768px) {
      body {
        padding-top: 60px; /* Space for fixed header */
      }
      header {
        font-size: 1.3rem;
        padding: 0.5rem;
      }
      .container {
        grid-template-columns: 1fr; /* Single column on mobile */
        padding: 0.5rem;
      }
      .card {
        padding: 0.8rem;
      }
      .card h2 {
        font-size: 1rem;
      }
      .description {
        font-size: 0.9rem;
      }
      .source {
        font-size: 0.75rem;
      }
      .votes button {
        font-size: 0.85rem;
        padding: 0.25rem 0.5rem;
      }
      .trend-of-the-day {
        flex-direction: column;
        align-items: flex-start;
        margin: 0.5rem;
        padding: 0.5rem;
      }
      .trend-of-the-day img {
        width: 60px;
        height: 60px;
      }
      .trend-of-the-day h2 {
        font-size: 0.9rem;
      }
      .filter-container {
        display: none; /* Hide filters on mobile, use offcanvas */
      }
    }
    @media (max-width: 480px) {
      .card h2 {
        font-size: 0.95rem;
      }
      .description {
        font-size: 0.85rem;
      }
      .btn {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
      }
    }
    /* Source-specific card styles */
    .card.HackerTrending { border-left: 4px solid #ff6600; background: #fff6f0; }
    .card.GithubTrending { border-left: 4px solid #24292e; background: #f8f9fa; }
    .card.RedditTrending { border-left: 4px solid #ff4500; background: #fff0f0; }
    .card.YouTubeTrending { border-left: 4px solid #cc0000; background: #ffe6e6; }
    .card.XTrending { border-left: 4px solid #1da1f2; background: #e6f3ff; }
    .card.BBCTrending { border-left: 4px solid #bb1919; background: #ffe6e6; }
    .card.DiggTrending { border-left: 4px solid #000000; background: #f8f9fa; }
    .card.SlashdotTrending { border-left: 4px solid #026664; background: #e6fafa; }
    .card.TechcrunchTrending { border-left: 4px solid #0f9d58; background: #e6f7ec; }
    .card.StackoverflowTrending { border-left: 4px solid #f48024; background: #fff5e6; }
    .card.DevtoTrending { border-left: 4px solid #0a0a0a; background: #f8f9fa; }
    .card.MediumtechTrending { border-left: 4px solid #00ab6c; background: #e6f7ec; }
    .card.LobstersTrending { border-left: 4px solid #a52a2a; background: #ffe6e6; }
    .card.WiredTrending { border-left: 4px solid #ff0000; background: #ffe6e6; }
    .card.ArsTechnicaTrending { border-left: 4px solid #ff4e00; background: #fff5e6; }
    .card.GoodreadsTrending { border-left: 4px solid #372213; background: #f8f9fa; }
    .card.SteamChartsTrending { border-left: 4px solid #171a21; background: #e6e9f0; }
    .card.SpotifyTrending { border-left: 4px solid #1db954; background: #e6f7ec; }
    .card.BillboardTrending { border-left: 4px solid #f76060; background: #fff0f0; }
    .card.IMDbTrending { border-left: 4px solid #f5de50; background: #fffbe6; }
    .card.CNNTrending { border-left: 4px solid #cc0000; background: #ffe6e6; }
    .card.ReutersTrending { border-left: 4px solid #2f3e46; background: #e6e9f0; }
    /* Theme variables */
    :root {
      --bg-color: linear-gradient(to bottom, #e0f7fa, #ffffff);
      --card-bg: #ffffff;
      --text-color: #333;
      --header-bg: #00796b;
      --header-text: #ffffff;
      --filter-bg: #00796b;
      --filter-text: #ffffff;
      --filter-label-bg: #e0f2f1;
      --filter-label-text: #004d40;
    }
    [data-theme="dark"] {
      --bg-color: linear-gradient(to bottom, #1a1a1a, #2c2c2c);
      --card-bg: #2c2c2c;
      --text-color: #e0e0e0;
      --header-bg: #004d40;
      --header-text: #e0e0e0;
      --filter-bg: #004d40;
      --filter-text: #e0e0e0;
      --filter-label-bg: #455a64;
      --filter-label-text: #e0e0e0;
    }
    [data-theme="fun"] {
      --bg-color: linear-gradient(to bottom, #ffeb3b, #ffca28);
      --card-bg: #fff9c4;
      --text-color: #d81b60;
      --header-bg: #f06292;
      --header-text: #ffffff;
      --filter-bg: #f06292;
      --filter-text: #ffffff;
      --filter-label-bg: #fce4ec;
      --filter-label-text: #d81b60;
    }
  </style>
</head>
<body>
  <header>
    <button class="navbar-toggler d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#filterOffcanvas" aria-controls="filterOffcanvas">
      <span class="navbar-toggler-icon"></span>
    </button>
    üî• Trendii Now
    <button id="theme-toggle" class="btn btn-sm btn-outline-light ms-3">Toggle Theme</button>
  </header>
  <div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas" aria-labelledby="filterOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="filterOffcanvasLabel">Filter Sources</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div class="filter-container">
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="all-sources" checked>
          <label class="form-check-label" for="all-sources">All Sources</label>
        </div>
        <div class="accordion" id="sourceAccordion">
          {% set source_groups = {
            'News': ['From Reuters', 'From CNN', 'From BBC'],
            'Social Media': ['From Reddit', 'From X', 'From YouTube'],
            'Tech': ['From Hacker', 'From Github', 'From Techcrunch', 'From Stackoverflow', 'From Mediumtech', 'From Devto', 'From Lobsters', 'From Slashdot', 'From ArsTechnica', 'From Wired'],
            'Entertainment': ['From IMDb', 'From Billboard', 'From Spotify', 'From Goodreads'],
            'Other': ['From SteamCharts', 'From Digg']
          } %}
          {% for category, sources in source_groups.items() %}
            {% if sources|select('in', unique_sources)|list %}
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ category|replace(' ', '') }}">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ category|replace(' ', '') }}" aria-expanded="false" aria-controls="collapse{{ category|replace(' ', '') }}">
                    {{ category }}
                  </button>
                </h2>
                <div id="collapse{{ category|replace(' ', '') }}" class="accordion-collapse collapse" aria-labelledby="heading{{ category|replace(' ', '') }}" data-bs-parent="#sourceAccordion">
                  <div class="accordion-body">
                    {% for source in sources %}
                      {% if source in unique_sources %}
                        <div class="form-check">
                          <input class="form-check-input source-checkbox" type="checkbox" value="{{ source }}" id="source{{ source|replace(' ', '') }}" checked>
                          <label class="form-check-label" for="source{{ source|replace(' ', '') }}">{{ source }}</label>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% if trend_of_the_day %}
  <section class="trend-of-the-day">
    {% if trend_of_the_day.image %}
      <img src="{{ trend_of_the_day.image }}" alt="Image for {{ trend_of_the_day.title }}" />
    {% endif %}
    <div>
      <h2><a href="/trend/{{ trend_of_the_day.id }}">{{ trend_of_the_day.title }}</a></h2>
      <span class="source {{ trend_of_the_day.source_class }}">{{ trend_of_the_day.source }}</span>
      {% if trend_of_the_day.mood_tags %}
        <div class="mood-tags">
          {% for tag in trend_of_the_day.mood_tags %}
            <span class="badge bg-primary">{{ tag }}</span>
          {% endfor %}
        </div>
      {% endif %}
      <a href="{{ trend_of_the_day.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary mt-1">See More</a>
    </div>
  </section>
  {% endif %}
  <div class="filter-container d-none d-md-block">
    <h5>Filter by Source</h5>
    <div class="form-check mb-2">
      <input class="form-check-input" type="checkbox" id="all-sources-desktop" checked>
      <label class="form-check-label" for="all-sources-desktop">All Sources</label>
    </div>
    <div class="accordion" id="sourceAccordionDesktop">
      {% for category, sources in source_groups.items() %}
  {% set matching_sources = [] %}
  {% for source in sources %}
    {% if source in unique_sources %}
      {% do matching_sources.append(source) %}
    {% endif %}
  {% endfor %}
  {% if matching_sources %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading{{ category|replace(' ', '') }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ category|replace(' ', '') }}" aria-expanded="false" aria-controls="collapse{{ category|replace(' ', '') }}">
          {{ category }}
        </button>
      </h2>
      <div id="collapse{{ category|replace(' ', '') }}" class="accordion-collapse collapse" aria-labelledby="heading{{ category|replace(' ', '') }}" data-bs-parent="#sourceAccordion">
        <div class="accordion-body">
          {% for source in matching_sources %}
            <div class="form-check">
              <input class="form-check-input source-checkbox" type="checkbox" value="{{ source }}" id="source{{ source|replace(' ', '') }}" checked>
              <label class="form-check-label" for="source{{ source|replace(' ', '') }}">{{ source }}</label>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}
{% endfor %}

      </div>
    </div>
    <main class="container">
      {% for trend in trends %}
      <article class="card {{ trend.source_class }}" data-id="{{ trend.id }}">
        <h2><a href="/trend/{{ trend.id }}">{{ trend.title }}</a></h2>
        {% if trend.image %}
          <img src="{{ trend.image }}" alt="Image for {{ trend.title }}" />
        {% endif %}
        {% if trend.description %}
          <p class="description">{{ trend.description }}</p>
        {% endif %}
        {% if trend.mood_tags %}
          <div class="mood-tags">
            {% for tag in trend.mood_tags %}
              <span class="badge bg-primary">{{ tag }}</span>
            {% endfor %}
          </div>
        {% endif %}
        <span class="source {{ trend.source_class }}">{{ trend.source }}</span>
        <p>Trending: {{ time_ago(trend.timestamp) }}</p>
        <div class="votes d-flex gap-2">
          <button class="vote-btn btn btn-outline-primary btn-sm" data-type="thumbs_up">üëç <span class="vote-count" data-type="thumbs_up">{{ vote_counts.get(trend.id, {}).get('thumbs_up', 0) }}</span></button>
          <button class="vote-btn btn btn-outline-danger btn-sm" data-type="fire">üî• <span class="vote-count" data-type="fire">{{ vote_counts.get(trend.id, {}).get('fire', 0) }}</span></button>
          <button class="vote-btn btn btn-outline-info btn-sm" data-type="mind_blown">üò≤ <span class="vote-count" data-type="mind_blown">{{ vote_counts.get(trend.id, {}).get('mind_blown', 0) }}</span></button>
        </div>
        <a href="{{ trend.link }}" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary mt-3 align-self-start">See More</a>
      </article>
      {% endfor %}
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const allSourcesCheckboxes = document.querySelectorAll('#all-sources, #all-sources-desktop');
      const checkboxes = document.querySelectorAll('.source-checkbox');
      const articles = document.querySelectorAll('.card');

      function filterArticles() {
        const activeSources = Array.from(checkboxes)
          .filter(c => c.checked)
          .map(c => c.value);
        articles.forEach(card => {
          const sourceText = card.querySelector('.source')?.textContent.trim();
          card.style.display = activeSources.includes(sourceText) ? '' : 'none';
        });
      }

      allSourcesCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          const isChecked = checkbox.checked;
          checkboxes.forEach(cb => cb.checked = isChecked);
          allSourcesCheckboxes.forEach(cb => cb.checked = isChecked);
          filterArticles();
        });
      });

      checkboxes.forEach(cb => {
        cb.addEventListener('change', () => {
          const allChecked = Array.from(checkboxes).every(cb => cb.checked);
          allSourcesCheckboxes.forEach(cb => cb.checked = allChecked);
          filterArticles();
        });
      });

      window.addEventListener('DOMContentLoaded', filterArticles);

      document.querySelectorAll('.vote-btn').forEach(button => {
        button.addEventListener('click', () => {
          const trendDiv = button.closest('.card');
          const trendId = trendDiv.getAttribute('data-id');
          const voteType = button.getAttribute('data-type');
          fetch('/api/vote', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ trend_id: trendId, vote_type: voteType })
          })
          .then(res => res.json())
          .then(data => {
            if (!data.error) {
              trendDiv.querySelectorAll('.vote-count').forEach(span => {
                const type = span.getAttribute('data-type');
                span.textContent = data[type] || 0;
              });
            } else {
              alert('Error: ' + data.error);
            }
          });
        });
      });

      function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      }
      document.getElementById('theme-toggle').addEventListener('click', () => {
        const current = localStorage.getItem('theme') || 'light';
        const next = current === 'light' ? 'dark' : current === 'dark' ? 'fun' : 'light';
        setTheme(next);
      });
      setTheme(localStorage.getItem('theme') || 'light');
    </script>
  </body>
</html>